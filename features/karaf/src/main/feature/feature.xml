<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<features name="${project.artifactId}-${project.version}" xmlns="http://karaf.apache.org/xmlns/features/v1.3.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://karaf.apache.org/xmlns/features/v1.3.0 http://karaf.apache.org/xmlns/features/v1.3.0">

    <repository>mvn:org.apache.cxf.karaf/apache-cxf/${cxf.version}/xml/features</repository>
    <repository>mvn:org.apache.aries.jax.rs/org.apache.aries.jax.rs.features/${aries.jax.rs.version}/xml</repository>
    <repository>mvn:org.apache.shiro/shiro-features/${shiro.version}/xml/features</repository>

    <feature name="kongmink-open-bean-validation" version="${project.version}">
        <bundle start-level="10" dependency="true">mvn:org.apache.geronimo.specs/geronimo-validation_2.0_spec/1.1</bundle>
        <bundle start-level="20" dependency="true">mvn:org.glassfish/jakarta.el/3.0.3</bundle>
        <bundle start-level="20">mvn:org.javaloong.kongmink.open/kongmink-open-bean-validator/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-hibernate-orm" version="${project.version}">
        <!-- hibernate-orm feature installs osgi.core and osgi.compendium bundle (it should not), causing huge refresh -->
        <feature prerequisite="true">pax-url-wrap</feature>
        <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.antlr/2.7.7_5</bundle>
        <bundle>mvn:org.jboss.logging/jboss-logging/3.4.1.Final</bundle>
        <bundle dependency="true">mvn:org.hibernate.javax.persistence/hibernate-jpa-2.1-api/${hibernate.jpa-2.1-api.verison}</bundle>
        <bundle>mvn:org.javassist/javassist/${javassist.version}</bundle>
        <bundle>mvn:net.bytebuddy/byte-buddy/1.10.10</bundle>
        <bundle dependency="true">mvn:org.jboss.spec.javax.transaction/jboss-transaction-api_1.2_spec/1.0.1.Final</bundle>
        <bundle>mvn:org.jboss/jandex/2.2.3.Final</bundle>
        <bundle>mvn:com.fasterxml/classmate/1.5.1</bundle>
        <bundle>wrap:mvn:org.dom4j/dom4j/2.1.1</bundle>
        <bundle>mvn:org.hibernate.common/hibernate-commons-annotations/5.0.1.Final</bundle>
        <bundle>mvn:org.hibernate/hibernate-core/${hibernate.version}</bundle>
        <bundle dependency="true">mvn:javax.interceptor/javax.interceptor-api/1.2.2</bundle>
        <bundle>mvn:org.hibernate/hibernate-osgi/${hibernate.version}</bundle>
    </feature>

    <feature name="kongmink-open-data-jpa" version="${project.version}">
        <feature>transaction</feature>
        <feature>jdbc</feature>
        <feature dependency="true">aries-blueprint</feature>
        <feature version="[2,3)">jpa</feature>
        <feature>kongmink-open-hibernate-orm</feature>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-common/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-data/${project.version}</bundle>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-data-jpa/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-data-jpa-xa-h2" version="${project.version}">
        <config name="org.apache.aries.tx.control.jpa.xa-h2">
            osgi.jdbc.driver.class=org.h2.Driver
            osgi.unit.name=km-open
            url=jdbc:h2:./data/kongmink_open
            aries.emf.builder.target.filter=(osgi.unit.provider=org.hibernate.jpa.HibernatePersistenceProvider)
            javax.persistence.schema-generation.database.action=drop-and-create
        </config>
        <feature>pax-jdbc-h2</feature>
        <feature>kongmink-open-data-jpa</feature>
        <bundle>mvn:org.apache.aries.tx-control/tx-control-provider-jpa-xa/${aries.tx.control.version}</bundle>
    </feature>

    <feature name="kongmink-open-data-jpa-xa-mysql" version="${project.version}">
        <config name="org.apache.aries.tx.control.jpa.xa-mysql">
            osgi.jdbc.driver.class=com.mysql.jdbc.Driver
            osgi.unit.name=km-open
            url=jdbc:mysql://localhost:3306/kongmink_open?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC
            user=root
            password=
            aries.emf.builder.target.filter=(osgi.unit.provider=org.hibernate.jpa.HibernatePersistenceProvider)
            javax.persistence.schema-generation.database.action=create
        </config>
        <feature>kongmink-open-data-jpa</feature>
        <bundle dependency="true">mvn:mysql/mysql-connector-java/8.0.26</bundle>
        <bundle>mvn:org.ops4j.pax.jdbc/pax-jdbc-mysql/${pax.jdbc.version}</bundle>
        <bundle>mvn:org.apache.aries.tx-control/tx-control-provider-jpa-xa/${aries.tx.control.version}</bundle>
    </feature>

    <feature name="kongmink-open-data-jpa-xa-psql" version="${project.version}">
        <config name="org.apache.aries.tx.control.jpa.xa-psql">
            osgi.jdbc.driver.class=org.postgresql.Driver
            osgi.unit.name=km-open
            url=jdbc:postgresql://localhost:5432/kongmink_open
            user=postgres
            password=postgres
            aries.emf.builder.target.filter=(osgi.unit.provider=org.hibernate.jpa.HibernatePersistenceProvider)
            javax.persistence.schema-generation.database.action=create
        </config>
        <feature>pax-jdbc-postgresql</feature>
        <feature>kongmink-open-data-jpa</feature>
        <bundle>mvn:org.apache.aries.tx-control/tx-control-provider-jpa-xa/${aries.tx.control.version}</bundle>
    </feature>

    <feature name="kongmink-open-account-keycloak" version="${project.version}">
        <feature>cxf-rs-security-oauth2</feature>
        <bundle dependency="true">mvn:org.keycloak/keycloak-common/${keycloak.version}</bundle>
        <bundle dependency="true">mvn:org.keycloak/keycloak-core/${keycloak.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-common/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-account-api/${project.version}</bundle>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-account-keycloak/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-am-keycloak" version="${project.version}">
        <feature>cxf-rs-security-oauth2</feature>
        <bundle dependency="true">mvn:org.keycloak/keycloak-common/${keycloak.version}</bundle>
        <bundle dependency="true">mvn:org.keycloak/keycloak-core/${keycloak.version}</bundle>
        <bundle dependency="true">mvn:org.apache.commons/commons-lang3/${commons.lang3.version}</bundle>
        <bundle dependency="true">mvn:org.modelmapper/modelmapper/${modelmapper.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-common/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-am-api/${project.version}</bundle>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-am-keycloak/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-service" version="${project.version}">
        <bundle dependency="true">mvn:org.modelmapper/modelmapper/${modelmapper.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-common/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-am-api/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-data/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-service/${project.version}</bundle>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-service-impl/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-jax-rs-whiteboard" version="${project.version}">
        <feature>aries-jax-rs-whiteboard</feature>
        <feature version="${cxf.version}">cxf-sse</feature>
        <bundle dependency="true">mvn:org.apache.aries.component-dsl/org.apache.aries.component-dsl.component-dsl/1.2.2</bundle>
    </feature>

    <feature name="kongmink-open-jax-rs-whiteboard-jackson" version="${project.version}">
        <config name="org.apache.aries.jax.rs.jackson">
            osgi.jaxrs.application.select="(!(jackson.json=false))"
        </config>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.core/jackson-databind/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.datatype/jackson-datatype-jsr310/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-base/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:com.fasterxml.jackson.module/jackson-module-jaxb-annotations/${jackson.version}</bundle>
        <bundle start-level="35" dependency="true">mvn:org.yaml/snakeyaml/1.27</bundle>
        <bundle>mvn:org.apache.aries.jax.rs/org.apache.aries.jax.rs.jackson/${aries.jax.rs.version}</bundle>
    </feature>

    <feature name="kongmink-open-jax-rs-whiteboard-openapi" version="${project.version}">
        <bundle dependency="true">mvn:org.apache.geronimo.specs/geronimo-validation_2.0_spec/1.1</bundle>
        <bundle dependency="true">mvn:org.apache.commons/commons-lang3/${commons.lang3.version}</bundle>
        <bundle dependency="true">mvn:io.github.classgraph/classgraph/4.8.117</bundle>
        <bundle dependency="true">mvn:io.swagger.core.v3/swagger-annotations/${swagger.v3.version}</bundle>
        <bundle dependency="true">mvn:io.swagger.core.v3/swagger-models/${swagger.v3.version}</bundle>
        <bundle dependency="true">mvn:io.swagger.core.v3/swagger-core/${swagger.v3.version}</bundle>
        <bundle dependency="true">mvn:io.swagger.core.v3/swagger-integration/${swagger.v3.version}</bundle>
        <bundle dependency="true">mvn:io.swagger.core.v3/swagger-jaxrs2/${swagger.v3.version}</bundle>
        <bundle>mvn:org.apache.aries.jax.rs/org.apache.aries.jax.rs.openapi.resource/${aries.jax.rs.version}</bundle>
    </feature>

    <feature name="kongmink-open-rest-core" version="${project.version}">
        <feature>kongmink-open-bean-validation</feature>
        <feature>kongmink-open-jax-rs-whiteboard</feature>
        <feature>kongmink-open-jax-rs-whiteboard-jackson</feature>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-common/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-service/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-rest/${project.version}</bundle>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-rest-core/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-rest-auth" version="${project.version}">
        <configfile finalname="${karaf.etc}/shiro.ini">mvn:org.javaloong.kongmink.open/kongmink-open-rest-auth/${project.version}/cfg/configuration</configfile>
        <feature>shiro-web</feature>
        <bundle dependency="true">mvn:commons-beanutils/commons-beanutils/1.9.4</bundle>
        <bundle dependency="true">mvn:commons-collections/commons-collections/3.2.2</bundle>
        <bundle dependency="true">mvn:org.apache.commons/commons-text/1.8</bundle>
        <bundle dependency="true">mvn:org.apache.commons/commons-configuration2/2.7</bundle>
        <bundle dependency="true">mvn:org.apache.shiro/shiro-jaxrs/${shiro.version}</bundle>
        <bundle dependency="true">mvn:org.pac4j/pac4j-core/${pac4j.version}</bundle>
        <bundle dependency="true">wrap:mvn:io.buji/buji-pac4j/${pac4j.buji.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-common/${project.version}</bundle>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-rest/${project.version}</bundle>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-rest-auth/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-rest-auth-oidc" version="${project.version}">
        <bundle dependency="true">wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>
        <bundle dependency="true">mvn:net.minidev/json-smart/${minidev.verison}</bundle>
        <bundle dependency="true">mvn:net.minidev/accessors-smart/${minidev.verison}</bundle>
        <bundle dependency="true">mvn:com.nimbusds/lang-tag/1.5</bundle>
        <bundle dependency="true">mvn:com.nimbusds/content-type/2.1</bundle>
        <bundle dependency="true">mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.sdk.version}</bundle>
        <bundle dependency="true">mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.jose.jwt.version}</bundle>
        <bundle>mvn:org.pac4j/pac4j-http/${pac4j.version}</bundle>
        <bundle>mvn:org.pac4j/pac4j-oidc/${pac4j.version}</bundle>
    </feature>

    <feature name="kongmink-open-rest-openapi" version="${project.version}">
        <feature>kongmink-open-jax-rs-whiteboard-openapi</feature>
        <bundle dependency="true">mvn:org.javaloong.kongmink.open/kongmink-open-rest/${project.version}</bundle>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-rest-openapi/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-rest-swagger-ui" version="${project.version}">
        <feature>pax-web-war</feature>
        <bundle>mvn:org.javaloong.kongmink.open/kongmink-open-rest-swagger-ui/${project.version}</bundle>
    </feature>

    <feature name="kongmink-open-rest-server" version="${project.version}">
        <feature>kongmink-open-account-keycloak</feature>
        <feature>kongmink-open-am-keycloak</feature>
        <feature>kongmink-open-data-jpa</feature>
        <feature>kongmink-open-service</feature>
        <feature>kongmink-open-rest-core</feature>
        <feature>kongmink-open-rest-openapi</feature>
        <feature>kongmink-open-rest-auth</feature>
        <feature>kongmink-open-rest-auth-oidc</feature>
    </feature>

    <feature name="kongmink-open-rest-server-h2" version="${project.version}">
        <feature>kongmink-open-data-jpa-xa-h2</feature>
        <feature>kongmink-open-rest-server</feature>
    </feature>

    <feature name="kongmink-open-rest-server-mysql" version="${project.version}">
        <feature>kongmink-open-data-jpa-xa-mysql</feature>
        <feature>kongmink-open-rest-server</feature>
    </feature>

    <feature name="kongmink-open-rest-server-psql" version="${project.version}">
        <feature>kongmink-open-data-jpa-xa-psql</feature>
        <feature>kongmink-open-rest-server</feature>
    </feature>

</features>
